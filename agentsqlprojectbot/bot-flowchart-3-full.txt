graph TD
    Start["ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ø¨ÙˆØª"] --> Init["ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…<br/>ØªØ­Ù…ÙŠÙ„ LLM Services"]
    Init --> Ready["âœ… Ø§Ù„Ø¨ÙˆØª Ø¬Ø§Ù‡Ø²"]
    
    Ready --> UserMsg{Ù†ÙˆØ¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø©ØŸ}
    
    %% ===== Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© =====
    UserMsg -->|/start| StartCmd["ğŸ“ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…"]
    StartCmd --> CreateUser["Ø¥Ù†Ø´Ø§Ø¡ UserInfo"]
    CreateUser --> SaveUser["ğŸ’¾ Ø­ÙØ¸ ÙÙŠ telegram_users"]
    SaveUser --> Welcome["ğŸ“¨ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨"]
    Welcome --> Ready
    
    UserMsg -->|/help| HelpCmd["ğŸ“– Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©"]
    HelpCmd --> CheckRole{Ø§Ù„Ø¯ÙˆØ±ØŸ}
    CheckRole -->|Ø¹Ø¶Ùˆ Ø¹Ø§Ø¯ÙŠ| LimitedHelp["Ø£ÙˆØ§Ù…Ø± Ù…Ø­Ø¯ÙˆØ¯Ø©"]
    CheckRole -->|Ù…Ø§Ù„Ùƒ Ù…Ø¤Ø³Ø³Ø©| FullHelp["Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙˆØ§Ù…Ø±"]
    LimitedHelp --> Ready
    FullHelp --> Ready
    
    UserMsg -->|/myinfo| InfoCmd["ğŸ‘¤ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…"]
    InfoCmd --> ShowInfo["Ø¹Ø±Ø¶: Ø§Ù„Ø¯ÙˆØ±ØŒ Ø§Ù„Ù…Ø¤Ø³Ø³Ø©ØŒ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ù†Ø´Ø·Ø©"]
    ShowInfo --> Ready
    
    UserMsg -->|/clear| ClearCmd["ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„"]
    ClearCmd --> ConfirmClear{ØªØ£ÙƒÙŠØ¯ØŸ}
    ConfirmClear -->|Ù†Ø¹Ù…| DeleteMem["Ø­Ø°Ù Ù…Ù† Ø§Ù„Ø°Ø§ÙƒØ±Ø©"]
    DeleteMem --> DeleteFiles["Ø­Ø°Ù Ù…Ù„ÙØ§Øª JSON"]
    DeleteFiles --> ClearDone["âœ… ØªÙ… Ø§Ù„Ø­Ø°Ù"]
    ConfirmClear -->|Ù„Ø§| CancelClear["âŒ Ø¥Ù„ØºØ§Ø¡"]
    ClearDone --> Ready
    CancelClear --> Ready
    
    UserMsg -->|/history| HistCmd["ğŸ“‹ Ø§Ù„Ø³Ø¬Ù„"]
    HistCmd --> ShowHist["Ø¹Ø±Ø¶ Ø¢Ø®Ø± 10 Ù…Ø­Ø§Ø¯Ø«Ø§Øª"]
    ShowHist --> Ready
    
    UserMsg -->|/stats| StatsCmd["ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª"]
    StatsCmd --> ShowStats["Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©ØŒ SQLØŒ Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ"]
    ShowStats --> Ready
    
    %% ===== Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…Ø¤Ø³Ø³Ø§Øª =====
    UserMsg -->|/createorg| CreateOrgCmd["âœ¨ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¤Ø³Ø³Ø©"]
    CreateOrgCmd --> CheckNotInOrg{Ù„ÙŠØ³ ÙÙŠ Ù…Ø¤Ø³Ø³Ø©ØŸ}
    CheckNotInOrg -->|Ù„Ø§| AlreadyInOrg["âŒ Ø£Ù†Øª Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ Ù…Ø¤Ø³Ø³Ø©"]
    CheckNotInOrg -->|Ù†Ø¹Ù…| GenOrgID["ØªÙˆÙ„ÙŠØ¯ org_id"]
    GenOrgID --> GenDashCreds["ğŸ” ØªÙˆÙ„ÙŠØ¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯"]
    GenDashCreds --> SaveOrg["ğŸ’¾ Ø­ÙØ¸ ÙÙŠ organizations"]
    SaveOrg --> SaveDashUser["ğŸ’¾ Ø­ÙØ¸ ÙÙŠ dashboard_users"]
    SaveDashUser --> SendCreds["ğŸ“¨ Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„"]
    SendCreds --> Ready
    AlreadyInOrg --> Ready
    
    UserMsg -->|/org| OrgCmd["ğŸ¢ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¤Ø³Ø³Ø©"]
    OrgCmd --> CheckOrgRole{Ø§Ù„Ø¯ÙˆØ±ØŸ}
    CheckOrgRole -->|Ù„ÙŠØ³ Ø¹Ø¶ÙˆØ§Ù‹| SuggestOrg["Ø§Ù‚ØªØ±Ø­ /createorg Ø£Ùˆ /join"]
    CheckOrgRole -->|Ø¹Ø¶Ùˆ| ShowOrgMember["Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ø­Ø¯ÙˆØ¯Ø©"]
    CheckOrgRole -->|Ù…Ø§Ù„Ùƒ| ShowOrgOwner["Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª"]
    SuggestOrg --> Ready
    ShowOrgMember --> Ready
    ShowOrgOwner --> Ready
    
    UserMsg -->|/orginfo| OrgInfoCmd["ğŸ“Š Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø¤Ø³Ø³Ø©"]
    OrgInfoCmd --> DisplayOrgInfo["Ø¹Ø±Ø¶: Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ØŒ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ØŒ Ø§Ù„ØªØ§Ø±ÙŠØ®"]
    DisplayOrgInfo --> Ready
    
    %% ===== Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª =====
    UserMsg -->|/adddb| AddDBCmd["â• Ø¥Ø¶Ø§ÙØ© Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª"]
    AddDBCmd --> CheckDBRole{Ø§Ù„Ø¯ÙˆØ±ØŸ}
    CheckDBRole -->|Ù…Ø§Ù„Ùƒ Ù…Ø¤Ø³Ø³Ø©| OrgDB["Ø¥Ø¶Ø§ÙØ© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡"]
    CheckDBRole -->|Ø¹Ø¶Ùˆ Ø¹Ø§Ø¯ÙŠ| PersonalDB["Ø¥Ø¶Ø§ÙØ© Ø´Ø®ØµÙŠØ© ÙÙ‚Ø·"]
    CheckDBRole -->|Ø¨Ø¯ÙˆÙ† Ù…Ø¤Ø³Ø³Ø©| IndividualDB["Ø¥Ø¶Ø§ÙØ© Ø´Ø®ØµÙŠØ©"]
    OrgDB --> ValidateConn["âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„"]
    PersonalDB --> ValidateConn
    IndividualDB --> ValidateConn
    ValidateConn --> ConnValid{ØµØ­ÙŠØ­ØŸ}
    ConnValid -->|Ù„Ø§| ConnError["âŒ Ø§ØªØµØ§Ù„ ØºÙŠØ± ØµØ­ÙŠØ­"]
    ConnValid -->|Ù†Ø¹Ù…| SaveDB["ğŸ’¾ Ø­ÙØ¸ ÙÙŠ database_connections"]
    SaveDB --> LinkOrgDB["ğŸ’¾ Ø±Ø¨Ø· ÙÙŠ organization_databases"]
    LinkOrgDB --> NotifyMembers["ğŸ“¢ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡"]
    NotifyMembers --> Ready
    ConnError --> Ready
    
    UserMsg -->|/selectdb| SelectDBCmd["ğŸ—„ï¸ Ø§Ø®ØªÙŠØ§Ø± Ù‚Ø§Ø¹Ø¯Ø©"]
    SelectDBCmd --> ListDBs["Ø¹Ø±Ø¶ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ù…ØªØ§Ø­Ø©"]
    ListDBs --> SelectActive["ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ù†Ø´Ø·Ø©"]
    SelectActive --> UpdateCache["ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒØ§Ø´"]
    UpdateCache --> Ready
    
    %% ===== Ø§Ù„Ø¯Ø¹ÙˆØ§Øª =====
    UserMsg -->|/invite| InviteCmd["ğŸ« Ø¥Ù†Ø´Ø§Ø¡ Ø¯Ø¹ÙˆØ©"]
    InviteCmd --> CheckOwner{Ù…Ø§Ù„Ùƒ Ù…Ø¤Ø³Ø³Ø©ØŸ}
    CheckOwner -->|Ù„Ø§| NoPermInvite["âŒ ØµÙ„Ø§Ø­ÙŠØ© Ù…Ø­ØµÙˆØ±Ø©"]
    CheckOwner -->|Ù†Ø¹Ù…| GenInvCode["ØªÙˆÙ„ÙŠØ¯ Ø±Ù…Ø² ÙØ±ÙŠØ¯"]
    GenInvCode --> SetExpiry["ØªØ­Ø¯ÙŠØ¯ ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡"]
    SetExpiry --> SetMaxUses["ØªØ­Ø¯ÙŠØ¯ Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ø§Øª"]
    SetMaxUses --> SaveInvite["ğŸ’¾ Ø­ÙØ¸ ÙÙŠ invitations"]
    SaveInvite --> SendInvLink["ğŸ“¨ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ©"]
    SendInvLink --> Ready
    NoPermInvite --> Ready
    
    UserMsg -->|/join| JoinCmd["ğŸ‘¥ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù…Ø¤Ø³Ø³Ø©"]
    JoinCmd --> ValidateInv{Ø±Ø§Ø¨Ø· ØµØ­ÙŠØ­ØŸ}
    ValidateInv -->|Ù„Ø§| InvError["âŒ Ø±Ø§Ø¨Ø· ØºÙŠØ± ØµØ­ÙŠØ­ Ø£Ùˆ Ù…Ù†ØªÙ‡ÙŠ"]
    ValidateInv -->|Ù†Ø¹Ù…| GenMemberCreds["ğŸ” ØªÙˆÙ„ÙŠØ¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¯Ø®ÙˆÙ„"]
    GenMemberCreds --> AddMember["Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ organization_members"]
    AddMember --> UpdateInvUses["ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ø§Øª"]
    UpdateInvUses --> NotifyOwner["ğŸ“¢ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø§Ù„Ùƒ"]
    NotifyOwner --> SendMemberCreds["ğŸ“¨ Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„"]
    SendMemberCreds --> Ready
    InvError --> Ready
    
    %% ===== Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© =====
    UserMsg -->|Ø±Ø³Ø§Ù„Ø© Ù†ØµÙŠØ©| QuestionFlow["ğŸ¤– Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø³Ø¤Ø§Ù„"]
    QuestionFlow --> CheckDB{Ù‚Ø§Ø¹Ø¯Ø© Ù…Ø­Ø¯Ø¯Ø©ØŸ}
    CheckDB -->|Ù„Ø§| NoDBError["âš ï¸ Ø§Ø®ØªØ± Ù‚Ø§Ø¹Ø¯Ø© Ø£ÙˆÙ„Ø§Ù‹"]
    NoDBError --> Ready
    
    CheckDB -->|Ù†Ø¹Ù…| RateLimit["â±ï¸ ÙØ­Øµ Rate Limit<br/>1 Ø·Ù„Ø¨/Ø«Ø§Ù†ÙŠØ©"]
    RateLimit --> RateLimited{Ù…Ø­Ø¯ÙˆØ¯ØŸ}
    RateLimited -->|Ù†Ø¹Ù…| WaitMsg["â³ Ø§Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹"]
    WaitMsg --> Ready
    
    RateLimited -->|Ù„Ø§| CheckActive["ÙØ­Øµ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©<br/>â‰¤ 1"]
    CheckActive --> MaxReached{ÙˆØµÙ„ Ø§Ù„Ø­Ø¯ØŸ}
    MaxReached -->|Ù†Ø¹Ù…| QueueMsg["ğŸ“¢ Ø·Ù„Ø¨Ø§Øª ÙƒØ«ÙŠØ±Ø© Ù…Ø¹Ù„Ù‚Ø©"]
    QueueMsg --> Ready
    
    %% ===== Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰: Ø§Ù„ØªØ­Ù„ÙŠÙ„ =====
    MaxReached -->|Ù„Ø§| Stage1["ğŸ” Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: Ø§Ù„ØªØ­Ù„ÙŠÙ„<br/>Gemini 2.5-Flash"]
    Stage1 --> LoadHistory["ØªØ­Ù…ÙŠÙ„ Ø¢Ø®Ø± 5 Ù…Ø­Ø§Ø¯Ø«Ø§Øª"]
    LoadHistory --> LoadSchema["ØªØ­Ù…ÙŠÙ„ Schema Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©"]
    LoadSchema --> AnalyzeQ["ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø¤Ø§Ù„"]
    AnalyzeQ --> CountTokens1["Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª"]
    CountTokens1 --> CalcCost1["Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙƒÙ„ÙØ©"]
    CalcCost1 --> SaveStage1["ğŸ’¾ Ø­ÙØ¸ Stage 1<br/>ÙÙŠ ConversationStages"]
    SaveStage1 --> DecideMethod{Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©ØŸ}
    
    %% ===== Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©: SQL =====
    DecideMethod -->|Ø§Ø³ØªØ¹Ù„Ø§Ù… SQL| Stage2["âš™ï¸ Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2: ØªÙ†ÙÙŠØ° SQL"]
    Stage2 --> ExecuteSQL["ØªÙ†ÙÙŠØ° Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…"]
    ExecuteSQL --> SQLSuccess{Ù†Ø¬Ø­ØŸ}
    SQLSuccess -->|Ù„Ø§| SQLError["âŒ Ø®Ø·Ø£ ÙÙŠ SQL"]
    SQLSuccess -->|Ù†Ø¹Ù…| FormatResults["Gemini 2.0-Flash<br/>ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù†ØªØ§Ø¦Ø¬"]
    FormatResults --> GenNLResponse["ØªÙˆÙ„ÙŠØ¯ Ø¥Ø¬Ø§Ø¨Ø© Ø·Ø¨ÙŠØ¹ÙŠØ©"]
    GenNLResponse --> CountTokens2["Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª"]
    CountTokens2 --> CalcCost2["Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙƒÙ„ÙØ©"]
    CalcCost2 --> SaveStage2["ğŸ’¾ Ø­ÙØ¸ Stage 2"]
    SaveStage2 --> SaveConv
    SQLError --> SaveConv
    
    %% ===== Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©: Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ =====
    DecideMethod -->|ØªÙˆÙ„ÙŠØ¯ Ø¥ÙŠÙ…ÙŠÙ„| Stage3["ğŸ“§ Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3: Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„<br/>Gemini 2.5-Flash"]
    Stage3 --> ExtractRecipients["Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù…Ø³ØªÙ„Ù…ÙŠÙ†"]
    ExtractRecipients --> GenEmail["ØªÙˆÙ„ÙŠØ¯ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„"]
    GenEmail --> CreateMailObj["Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ§Ø¦Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯"]
    CreateMailObj --> CountTokens3["Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª"]
    CountTokens3 --> CalcCost3["Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙƒÙ„ÙØ©"]
    CalcCost3 --> SaveStage3["ğŸ’¾ Ø­ÙØ¸ Stage 3"]
    SaveStage3 --> SaveConv
    
    %% ===== Ø¥Ø¬Ø§Ø¨Ø© Ù…Ø¨Ø§Ø´Ø±Ø© =====
    DecideMethod -->|Ø¥Ø¬Ø§Ø¨Ø© Ù…Ø¨Ø§Ø´Ø±Ø©| DirectAnswer["Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ù„Ø®Øµ"]
    DirectAnswer --> SaveConv
    
    %% ===== Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„Ø¥Ø±Ø³Ø§Ù„ =====
    SaveConv["ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©"] --> SaveJSON["Ø­ÙØ¸ ÙÙŠ JSON"]
    SaveJSON --> SaveSQL["ğŸ’¾ Ø­ÙØ¸ ÙÙŠ Conversations"]
    SaveSQL --> UpdateUsage["ØªØ­Ø¯ÙŠØ« ModelUsage<br/>StagesUsage<br/>OrgModelUsage"]
    UpdateUsage --> CalcTotalCost["Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©"]
    CalcTotalCost --> SendResponse["ğŸ“¨ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯"]
    SendResponse --> HasEmail{ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¥ÙŠÙ…ÙŠÙ„ØŸ}
    
    HasEmail -->|Ù†Ø¹Ù…| ShowEmailBtns["Ø¹Ø±Ø¶ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„<br/>ğŸ“§ Ù…Ø¹Ø§ÙŠÙ†Ø© | Ø¥Ø±Ø³Ø§Ù„"]
    HasEmail -->|Ù„Ø§| NormalMsg["Ø±Ø³Ø§Ù„Ø© Ø¹Ø§Ø¯ÙŠØ©"]
    ShowEmailBtns --> WaitAction["Ø§Ù†ØªØ¸Ø§Ø± ÙØ¹Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…"]
    NormalMsg --> Ready
    
    WaitAction --> UserAction{Ø§Ù„ÙØ¹Ù„ØŸ}
    UserAction -->|Ù…Ø¹Ø§ÙŠÙ†Ø©| PreviewEmail["Ø¹Ø±Ø¶ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„"]
    PreviewEmail --> ConfirmSend{ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ØŸ}
    ConfirmSend -->|Ù†Ø¹Ù…| SendSMTP["ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± SMTP"]
    ConfirmSend -->|Ù„Ø§| CancelEmail["âŒ Ø¥Ù„ØºØ§Ø¡"]
    SendSMTP --> LogEmail["ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©"]
    LogEmail --> Ready
    CancelEmail --> Ready
    UserAction -->|ØªØ¬Ø§Ù‡Ù„| Ready
    
    style Start fill:#0088cc,stroke:#005fa3,color:#fff
    style Stage1 fill:#e74c3c,stroke:#c0392b,color:#fff
    style Stage2 fill:#9b59b6,stroke:#7d3c98,color:#fff
    style Stage3 fill:#27ae60,stroke:#1e8449,color:#fff
    style SaveConv fill:#f39c12,stroke:#d68910,color:#fff
    style SendResponse fill:#3498db,stroke:#2980b9,color:#fff